---
title: "Case 2 Part 1"
author: "Sonia Xu"
date: "September 29, 2017"
output:
  pdf_document: default
  html_document: default
---

<!--Week 1: Case study introduced in detail in the Wed lecture including questions from the students, and some relevant background on how the data were collected, the scientific focus, common ways to analyze the data, etc.  Students are expected to download the data, conduct exploratory/descriptive analyses of the data, clean the data (as needed) and outline several possible approaches for analyzing the data to address the scientific goals of the study by the next week’s lecture (at which point a write-up describing the results from the initial analyses and the different potential approaches to analysis) is due.  These interim reports will be graded, and should include a short description of the roles of each of the “authors” (team members) in the work.  -->


<!---
CASE STUDY 2: 

BACKGROUND: Study of time to critical neurological assessment for patients with stroke-like symptoms who are admitted to the emergency room.  A possible predictor is number of major stroke symptoms reported, ranging from 0 to 4.  Treatment for acute stroke includes thrombolytic therapy, which can potentially improve neurological functioning for ischemic stroke patients if administered soon after symptom onset (within 3 hours).  Since treating patients quickly is critically important for their long-term prognosis, minimizing the times from symptom onset to emergency room (ED) arrival, from ED arrival to diagnosis, and from diagnosis to treatment is of paramount concern.

INTEREST: Factors predictive of the time to critical neurological assessment following admission to the ED for n=335 patients with mild to moderate motor impairment.  The goal of the analysis is to perform inferences on the impact of clinical presentation, gender and race on time to neurological assessment.  Clinical presentation is measured as a count of reported major stroke symptoms, including headache, loss of motor skills or weakness, trouble talking or understanding, and vision problems.

Variable key: 
nctdel = min of neurologist time to assessment & CT scan from arrival at ER
fail = 1 if got neurologist/CT scan & 0 otherwise
male = 1 if male, 0=female
black = 1 if black, 0=not black 
hisp = 1 if hispanic, 0=not hispanic
sn1 = 0/1 indicator 1 main symptom
sn2 = 0/1 indicator 2 main symptoms
sn3 = 0/1 indicator 3 main symptoms 
all4 = 0/1 indicator all 4 main symptoms
--->

#load libraries
```{r}
library(dplyr)
library(magrittr)
library(knitr)
```

#Read in Dataset
```{r}
kelly <- read.table("kellydat.txt", header = T)
```

#Cleaning the Data
Since the symptoms cannot be uniquely identified, we decided to to combine the count of all symptoms into one covariate called $count_sn$. This new variable is the count of the number of symptoms each observation may have, so it ranges from 0 to 4.
```{r echo = F}
kelly <- kelly %>% mutate(count_sn = sn1 + sn2*2 + sn3*3 + all4*4) %>% select(-c(sn1, sn2, sn3, all4))
kable(head(kelly))
```

#Exploratory Data Analysis
After cleaning the dataset, there are five covariates that can predict the response, wait time. Since three of these covariates are associated with patient demographics, we hypothesize that there may exist social bias in the wait time of a patient, and explore this assumption via exploratory data analysis.

##Racial Bias

##Gender Bias
-talk about bias
  -look for racial and gender bias
  
-compare the differences between who was rejected and who wasn't (fail)

```{r}
hist(kelly$nctdel[kelly$nctdel!=0.0],breaks=40,freq=F) # dist of wait times (zero wait times removed)
lines(seq(0,26),dpois(seq(0,26),1.46),type="p",col="red") # poisson model, arbitrary lambda
hist(kelly$count_sn,breaks=50) # dist of symptom counts

```

#Possible Approaches to the Data
In an effort to understand factors predictive of wait time, we could model the wait time for each patient as a Poisson distribution. However, after attempting to fit a Poisson distribution with $\lambda = 1.46$, we noticed that it did not capture the data robustly enough. Below are three potential approaches to alleviate this challenge:

1. We plan to separate the model into bins, and to model each bin with a piecewise constant hazard.

2. We could avoid modeling the data and non-parametrically estimate it via a Kaplan-Meier estimate.

3. We could also cluster the data to check to see whether or not people with similar characters have similar wait times from the waiting room to the ER.

4. Decision trees(?)


Notes from class

#Kaplan Meier Estimate
```{r}
library(survival)
d2 <- Surv(kelly$nctdel, kelly$fail) #creates a survival object #preprocessed version of the data
km <- survfit(d2 ~ kelly$male)
plot(km, col = c("red", "blue"))
print(km)
```